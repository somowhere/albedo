<?xml version="1.0" encoding="utf-8"?>
<template>
    <name>viewList</name>
    <filePath>src/main/webapp/WEB-INF/views/${lastPackageName}/${moduleName}/${subModuleName}</filePath>
    <fileName>${className}List.ftl</fileName>
    <content><![CDATA[
<#macro jspEl>${r"$"}</#macro>
<#macro at>${r"@"}</#macro><#macro hash>${r"#"}</#macro>
<div class="row">
	<div class="col-md-2">
		<<@at />albedo.treeShow id="${className}_" title="${functionNameSimple}" selectNodeId="nodeId" url="<@jspEl />{ctx}/${urlPrefix}/findTreeData?all" 
		clickNodeFn="clickTreeNode${ClassName}" allowCancelSelect="true" cancelClickNodeFn="cancelClickNode${ClassName}" nodesLevel="1"> </<@at />albedo.treeShow>
	</div>
    <div class="col-md-10">
        <!-- BEGIN EXAMPLE TABLE PORTLET-->
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption font-blue">
                    	数据列表
                </div>
                <div class="actions">
                    <div class="btn-group">
                        <<@hash />if SecurityUtil.hasPermission('${permissionPrefix}_edit')><a id="add-${className}" class="btn red dialog" href="javascript:void(0);" 
                        data-url="<@jspEl />{ctx}/${urlPrefix}/edit" data-reload-after="refreshTree${ClassName}" data-is-modal="<#if scheme.modalView>true</#if>" data-modal-width="950" data-table-id="#data-table-${className}">
                            <i class="fa fa-plus"> 添加${functionNameSimple}</i>
                        </a></<@hash />if>
                    </div>
                </div>
            </div>
            <div class="portlet-body">
            	<form class="form-inline form-search" id="form-search-${className}">
            		<input id="parentId" name="parentId" type="hidden" operate="eq" searchItem="searchItem"/>
                    <#list table.columnList as c>
						<#if c.isQuery?? && c.isQuery == 1>
						<div class="form-group">
					                             <label class="input-label" for="${c.javaFieldId}">${c.comments}</label>
						<#if c.showType == "input" || c.showType == "textarea">
							<input type="text" class="form-control" searchItem="searchItem" id="${c.javaFieldId}" name="${c.javaFieldId}" value="${"$"}{(${className}.${c.javaFieldId})!}" operate="${c.queryType}" htmlEscape="false"<#if c.dataLength != "0"> maxlength="${c.dataLength}"</#if> placeholder="...">
						<#elseif c.showType == "select" || c.showType == "checkbox" || c.showType == "radio">
							<<@at/>albedo.form name="${c.javaFieldId}" searchItem="searchItem" dictCode="${c.dictType}" boxType="${c.showType}" value="${"$"}{(${className}.${c.javaFieldId})!}" operate="${c.queryType}" attrType="${c.javaType}"> </<@at/>albedo.form></div>
						<#elseif c.showType == "dateselect">
							<div class="input-group date date-time-picker"><input type="text" name="${c.javaFieldId}" searchItem="searchItem" operate="${c.queryType}" attrType="${c.javaType}" readonly class="form-control" value="${"$"}{(${className}.${c.javaFieldId})!}"><span class="input-group-btn"><button class="btn default date-set" type="button"><i class="fa fa-calendar"></i></button></span></div>
						<#elseif c.showType == "userselect">
							<<@at/>albedo.treeSelect searchItem="searchItem" operate="${c.queryType}" name="${c.simpleJavaField}Id" allowClear="true" labelName="${c.javaFieldShowName}" value="<@jspEl />{(${className}.${c.simpleJavaField}Id)!}" labelValue="<@jspEl />{(${className}.${c.javaFieldName})!}" 
							title="选择用户" url="<@jspEl/>{ctx}/sys/org/findTreeData?showType=3" notAllowSelectParent="true"> </<@at/>albedo.treeSelect>
						<#elseif c.showType == "orgselect">
							<<@at/>albedo.treeSelect searchItem="searchItem" operate="${c.queryType}" name="${c.simpleJavaField}Id" allowClear="true" labelName="${c.javaFieldShowName}" value="<@jspEl />{(${className}.${c.simpleJavaField}Id)!}" labelValue="<@jspEl />{(${className}.${c.javaFieldName})!}" 
							title="选择部门" url="<@jspEl/>{ctx}/sys/org/findTreeData?showType=1" notAllowSelectParent="true"> </<@at/>albedo.treeSelect>
						<#elseif c.showType == "areaselect">
							<<@at/>albedo.treeSelect searchItem="searchItem" operate="${c.queryType}" name="${c.simpleJavaField}Id" allowClear="true" labelName="${c.javaFieldShowName}" value="<@jspEl />{(${className}.${c.simpleJavaField}Id)!}" labelValue="<@jspEl />{(${className}.${c.javaFieldName})!}" 
							title="选择区域" url="<@jspEl/>{ctx}/sys/area/findTreeData" notAllowSelectParent="true"> </<@at/>albedo.treeSelect>
						</#if>
						</div>
						</#if>
					</#list>
					<div class="form-group form-btn">
                        <button class="btn btn-sm green btn-outline filter-submit-table-${className} margin-bottom" type="button"><i class="fa fa-search"></i> 查询</button>
                        <button class="btn btn-sm red btn-outline filter-cancel" type="reset"><i class="fa fa-times"></i> 重置</button>
                    </div>
                </form>
                <hr />
          		<div id="bootstrap-alerts"></div>
                <table class="table table-striped table-bordered table-hover dataTable no-footer dt-responsive" id="data-table-${className}">
                    <thead>
                    <tr ${className}="row" class="heading">
                    	<#list table.columnList as column><#if column.isList?? && column.isList == 1 && column.simpleJavaField!="parentId" && column.simpleJavaField!="parentIds" && column.simpleJavaField!="parent">
                    	<th class="<#if column_index == 1>all<#elseif column_index gt 8>none</#if>"> ${column.comments} </th>
                    </#if></#list>
                    <<@hash/>if SecurityUtil.hasPermission('${permissionPrefix}_edit,${permissionPrefix}_delete,${permissionPrefix}_lock')><th width="10%"> 操作 </th></<@hash/>if>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- END EXAMPLE TABLE PORTLET-->
    </div>
</div>
<!-- END PAGE BASE CONTENT -->
<script type="text/javascript">
    var data${ClassName}Tables = function () {
        var initTradeOrderTable = function () {
        	var grid = new Datatable();
            grid.init({
                src: $("#data-table-${className}"),
                dataTable: {
                    "ajax": {
                        "url": "<@jspEl />{ctx}/${urlPrefix}/page",
                        type: 'GET',
                        "dataType": 'json'
                    },
                    "columns": [<#assign firstListField = true>
					<#list table.columnList as column>
					<#if column.isList?? && column.isList == 1 && column.simpleJavaField!="parentId" && column.simpleJavaField!="parentIds" && column.simpleJavaField!="parent">
					<#if column.simpleJavaField = 'status'>  
					<#if !firstListField>, </#if>{data:'${column.simpleJavaField}',render: function(data, type, row){
						var temp = '<span class="label label-sm label-'+(data == "正常" ? "info" : "warning")+'">'+data+'</span>';
						<<@hash/>if SecurityUtil.hasPermission('${permissionPrefix}_lock')>temp = '<a href="javascript:void(0);" class="confirm" data-table-id="#data-table-${className}" data-method="delete" data-title="你确认要操作选中的${functionNameSimple}吗？" data-url="<@jspEl />{ctx}/${urlPrefix}/lock/'+row.id+'" title=\"'+(row.status=="正常" ? "锁定" : "解锁") +'${functionNameSimple}\">'+temp+'</a></span>';</<@hash/>if>
						return temp;
					}}
					<#elseif column.name == 'created_by'>
					<#if !firstListField>, </#if>{data:'creator${column.defaultJavaFieldName?cap_first}'
					<#elseif column.name == 'last_modified_by'>
					<#if !firstListField>, </#if>{data:'modifier${column.defaultJavaFieldName?cap_first}'
					<#else>
					<#if !firstListField>, </#if>{data:'${column.simpleJavaField}<#if column.simpleJavaType == "User" || column.simpleJavaType == "Org" || column.simpleJavaType == "Area">${column.defaultJavaFieldName?cap_first}</#if>'
					<#if firstListField>, render: function(data, type, row){
						<<@hash/>if SecurityUtil.hasPermission('${permissionPrefix}_edit')>data = '<a href="javascript:void(0);" class="dialog" data-table-id="#data-table-${className}" data-is-modal="<#if scheme.modalView>true</#if>" data-url="<@jspEl />{ctx}/${urlPrefix}/edit?id='+row.id+'" title=\"点击编辑${functionNameSimple}\">'+data+'</a>'</<@hash/>if>
						return data;
					}<#assign firstListField = false></#if>}
					</#if>
					</#if>
					</#list>
					<<@hash/>if SecurityUtil.hasPermission('${permissionPrefix}_edit,${permissionPrefix}_delete,${permissionPrefix}_lock')><#if table.columnList?size != 0>, </#if>
                        { orderable: false, data: function ( row, type, val, meta ) {
                        	var data = '<span class="operation">'<<@hash/>if SecurityUtil.hasPermission('${permissionPrefix}_edit')>+'<a href="javascript:void(0);" class="dialog" data-table-id="#data-table-${className}" data-reload-after="refreshTree${ClassName}" data-is-modal="<#if scheme.modalView>true</#if>" data-modal-width="950" data-url="<@jspEl />{ctx}/${urlPrefix}/edit?id='+row.id+'"><i class=\"fa fa-lg fa-pencil\" title=\"编辑${functionNameSimple}\"></i></a>'</<@hash/>if>
                    		<<@hash/>if SecurityUtil.hasPermission('${permissionPrefix}_lock')>+'<a href="javascript:void(0);" class="confirm" data-table-id="#data-table-${className}" data-title="你确认要操作选中的${functionNameSimple}吗？" data-url="<@jspEl />{ctx}/${urlPrefix}/lock/'+row.id+'"><i class=\"fa fa-lg fa-'+(row.status=="正常" ? "unlock" : "lock") +'  font-yellow-gold\" title=\"'+(row.status=="正常" ? "锁定" : "解锁") +'${functionNameSimple}\"></i></a></span>'</<@hash/>if>
                    		<<@hash/>if SecurityUtil.hasPermission('${permissionPrefix}_delete')>+'<a href="javascript:void(0);" class="confirm" data-table-id="#data-table-${className}" data-reload-after="refreshTree${ClassName}" data-method="post" data-title="你确认要删除选中的${functionNameSimple}吗？" data-url="<@jspEl />{ctx}/${urlPrefix}/delete/'+row.id+'"><i class=\"fa fa-lg fa-trash-o font-red-mint\" title=\"删除\"></i></a></span>'</<@hash/>if>+'<\span>';
                        	return data;
                        }
                        }</<@hash/>if>
                    ]
                }
            });
            $(".filter-submit-table-${className}").click(function(){
            	$("#data-table-${className}").DataTable().ajax.reload();
            })
        };
        return {
            init: function () {
                if (!jQuery().dataTable) {
                    return;
                }
                initTradeOrderTable();
            }
        };
    }();
    var nodeId = albedo.getUserCookie("tree_${className}_select_node_id"), nodeId = (nodeId)? nodeId : 1, addUrl = $("#add-${className}").attr("data-url");;
    jQuery(document).ready(function() {
        data${ClassName}Tables.init();
    });
    function cancelClickNode${ClassName}(event, treeId, treeNode){
    	albedo.setCookie("tree_${className}_select_node_id", '');
		$("#parentId").val('');
		$(".filter-submit-table-${className}").trigger("click");
	}	
    function refreshTree${ClassName}(re){
    	$(".tree-refresh").trigger("click");
    }
	function clickTreeNode${ClassName}(event, treeId, treeNode){
		nodeId=treeNode.id;
		albedo.setCookie("tree_${className}_select_node_id", nodeId);
		if(addUrl)$("#add-${className}").attr("data-url", addUrl + (addUrl.indexOf("?")==-1 ? "?" : "&")+"parentId="+treeNode.id);
		$("#parentId").val(treeNode.id);
		$(".filter-submit-table-${className}").trigger("click");
	}	
</script>
</body>
</html>]]>
    </content>
</template>